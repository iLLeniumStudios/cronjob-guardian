# Default values for cronjob-guardian.
# This is a YAML-formatted file.

# +docs:section=General

# Number of replicas. Use 1 for leader election, or increase with leaderElection.enabled=true
replicaCount: 1

# Override the name of the chart
nameOverride: ""
# Override the full name of the chart
fullnameOverride: ""

# +docs:section=Image

image:
  # Image registry (optional, prepended to repository if set)
  registry: ""
  # Image repository
  repository: ghcr.io/illeniumstudios/cronjob-guardian
  # Image pull policy
  pullPolicy: IfNotPresent
  # Image tag (defaults to appVersion)
  tag: ""

# Image pull secrets for private registries
imagePullSecrets: []

# +docs:section=ServiceAccount & RBAC

serviceAccount:
  # Create a ServiceAccount
  create: true
  # Automatically mount ServiceAccount token
  automount: true
  # ServiceAccount annotations
  annotations: {}
  # ServiceAccount name (auto-generated if not set)
  name: ""

rbac:
  # Create ClusterRole and ClusterRoleBinding
  create: true

# +docs:section=Pod Configuration

# Pod annotations
podAnnotations: {}

# Pod labels
podLabels: {}

# Pod security context
podSecurityContext: {}

# Container security context
securityContext: {}

# Termination grace period in seconds
terminationGracePeriodSeconds: 10

# Resource limits and requests
resources:
  limits:
    cpu: 500m
    memory: 256Mi
  requests:
    cpu: 10m
    memory: 64Mi

# Liveness probe configuration
livenessProbe:
  initialDelaySeconds: 15
  periodSeconds: 20
  timeoutSeconds: 1
  failureThreshold: 3

# Readiness probe configuration
readinessProbe:
  initialDelaySeconds: 5
  periodSeconds: 10
  timeoutSeconds: 1
  failureThreshold: 3

# Additional environment variables
extraEnv: []

# Additional volume mounts
extraVolumeMounts: []

# Additional volumes
extraVolumes: []

# +docs:section=Scheduling

# Node selector
nodeSelector: {}

# Tolerations
tolerations: []

# Affinity rules
affinity: {}

# +docs:section=Operator Configuration

config:
  # Log level (debug, info, warn, error)
  logLevel: info

  scheduler:
    # Dead-man's switch check interval
    deadManSwitchInterval: 1m
    # SLA recalculation interval
    slaRecalculationInterval: 5m
    # History prune interval
    pruneInterval: 1h
    # Grace period after startup before sending alerts (prevents alert floods on restart)
    startupGracePeriod: 30s

  historyRetention:
    # Default retention period in days
    defaultDays: 30
    # Maximum retention period in days
    maxDays: 90

  rateLimits:
    # Maximum alerts per minute across all channels
    maxAlertsPerMinute: 50
    # Maximum burst of alerts allowed (default: 10)
    burstLimit: 10
    # Default duration to suppress duplicate alerts (default: 1h)
    defaultSuppressDuplicatesFor: 1h

  # +docs:section=Storage
  # Configuration for the storage backend. Supports SQLite (default), PostgreSQL, and MySQL.
  storage:
    # Storage type: sqlite, postgres, or mysql
    type: sqlite

    sqlite:
      # Path to SQLite database file
      path: /data/guardian.db

    postgres:
      # PostgreSQL host
      host: ""
      # PostgreSQL port
      port: 5432
      # PostgreSQL database name
      database: ""
      # PostgreSQL username
      username: ""
      # PostgreSQL password (ignored if existingSecret is set)
      password: ""
      # Use existing secret for password
      existingSecret: ""
      # Key in existing secret containing password
      existingSecretKey: password
      # PostgreSQL SSL mode
      sslMode: require
      # Connection pool settings
      pool:
        # Maximum number of idle connections
        maxIdleConns: 10
        # Maximum number of open connections
        maxOpenConns: 100
        # Maximum connection lifetime
        connMaxLifetime: 1h
        # Maximum idle time for connections
        connMaxIdleTime: 10m

    mysql:
      # MySQL host
      host: ""
      # MySQL port
      port: 3306
      # MySQL database name
      database: ""
      # MySQL username
      username: ""
      # MySQL password (ignored if existingSecret is set)
      password: ""
      # Use existing secret for password
      existingSecret: ""
      # Key in existing secret containing password
      existingSecretKey: password
      # Connection pool settings
      pool:
        # Maximum number of idle connections
        maxIdleConns: 10
        # Maximum number of open connections
        maxOpenConns: 100
        # Maximum connection lifetime
        connMaxLifetime: 1h
        # Maximum idle time for connections
        connMaxIdleTime: 10m

    # Enable storing job logs in database
    logStorageEnabled: false
    # Enable storing K8s events in database
    eventStorageEnabled: false
    # Maximum log size to store per execution (KB)
    maxLogSizeKB: 100
    # Log retention days (0 = use history-retention.default-days)
    logRetentionDays: 0

# +docs:section=Persistence
# Persistence configuration for SQLite storage backend.

persistence:
  # Enable persistence (required for SQLite)
  enabled: true
  # Storage class (use "-" for default, or specify a class name)
  storageClass: ""
  # Access modes
  accessModes:
    - ReadWriteOnce
  # Storage size
  size: 1Gi
  # PVC annotations
  annotations: {}
  # PVC selector
  selector: {}

# +docs:section=UI & Ingress
# Configuration for the web UI and REST API server.

ui:
  # Enable UI server
  enabled: true
  # UI server port
  port: 8080

  service:
    # Service type (ClusterIP, NodePort, LoadBalancer)
    type: ClusterIP
    # Service port
    port: 8080
    # NodePort (only used if type=NodePort)
    nodePort: null
    # Service annotations
    annotations: {}

  ingress:
    # Enable ingress
    enabled: false
    # Ingress class name
    className: ""
    # Ingress annotations
    annotations: {}
    # Ingress hosts
    hosts:
      - host: cronjob-guardian.local
        paths:
          - path: /
            pathType: Prefix
    # Ingress TLS configuration
    tls: []
    #  - secretName: cronjob-guardian-tls
    #    hosts:
    #      - cronjob-guardian.local

  route:
    # Enable OpenShift Route
    enabled: false
    # Route host (leave empty for auto-generated)
    host: ""
    # Route path
    path: ""
    # Route annotations
    annotations: {}
    tls:
      # Enable TLS termination
      enabled: true
      # TLS termination type (edge, passthrough, reencrypt)
      termination: edge
      # Insecure edge termination policy (Allow, Redirect, None)
      insecureEdgeTerminationPolicy: Redirect

# +docs:section=Metrics & Monitoring
# Prometheus metrics and ServiceMonitor configuration.

metrics:
  # Enable metrics endpoint
  enabled: true
  # Metrics bind address (port only, e.g., ":8443")
  bindAddress: ":8443"
  # Enable HTTPS for metrics
  secure: true
  # Path to TLS certificate directory
  certPath: ""
  # TLS certificate file name
  certName: tls.crt
  # TLS key file name
  certKey: tls.key

probes:
  # Probes bind address
  bindAddress: ":8081"

serviceMonitor:
  # Enable ServiceMonitor
  enabled: false
  # ServiceMonitor labels
  labels: {}
  # Scrape interval
  interval: 30s
  # Scrape timeout
  scrapeTimeout: 10s
  # Metric relabelings
  metricRelabelings: []
  # Relabelings
  relabelings: []

# +docs:section=High Availability
# Leader election configuration for running multiple replicas.

leaderElection:
  # Enable leader election (required for multiple replicas)
  enabled: false
  # Leader lease duration
  leaseDuration: 15s
  # Leader renew deadline
  renewDeadline: 10s
  # Leader retry period
  retryPeriod: 2s

# +docs:section=Webhook

webhook:
  # Path to TLS certificate directory
  certPath: ""
  # TLS certificate file name
  certName: tls.crt
  # TLS key file name
  certKey: tls.key
  # Enable HTTP/2 for webhook server
  enableHTTP2: false
